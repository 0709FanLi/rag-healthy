# Healthy RAG - 智能健康管家产品文档 (v1.0)

## 1. 项目概述
**Healthy RAG** 是一款基于 AI 大模型（DeepSeek-Reasoner）的智能健康管理应用。它通过自然对话的形式，采集用户的基本信息（年龄、性别）和健康困扰，利用 AI 深度推理能力锁定健康赛道，生成个性化的生活方式评估问卷，并最终输出一份可视化的健康评估报告与产品推荐。

本项目定位为企业级应用的初期版本，强调代码的模块化、可扩展性与安全性。

## 2. 核心用户流程 (User Flow)

### 2.1 登录阶段
*   **功能**：受限访问，仅允许特定账号登录。
*   **交互**：
    *   用户访问首页，展示登录框。
    *   输入后端预设的账号密码（无注册功能）。
    *   验证通过后发放 Token（如 JWT），跳转至对话页。

### 2.2 AI 健康问诊 (对话核心)
*   **初始化**：
    *   进入页面后，AI 主动发送欢迎语（两句话）：
        > 第一句："您好！我是您的 AI 健康管家。"
        > 第二句："为了提供精准的评估，我们需要为您进行定制化的对话采集。请描述您的年龄、性别，以及最近最困扰您的问题。"
*   **对话交互 (Phase 0 - 前置校验)**：
    *   **完整性检查**：用户回复后，AI 检查是否包含【年龄、性别、核心症状】。
        *   *缺失*：AI 温柔追问缺失项。
        *   *无关*：若用户谈论无关话题（如天气、政治），AI 礼貌拒绝并引导回健康话题。
*   **赛道锁定 (Step 1)**：
    *   AI 根据用户主诉，在后台将其归类为 **七大健康赛道** 之一（消化、骨骼代谢、神经、免疫血液、内分泌、皮肤、心血管）。
*   **问卷采集 (Step 2)**：
    *   基于锁定赛道，AI 生成 3-5 道生活方式选择题（单选），涵盖饮食、作息、运动等方面。
    *   AI逐一问问题，用户回答后再问下一道。
    *   用户逐一或批量回答问题。
*   **加载状态**：
    *   由于使用 DeepSeek-Reasoner (思考模式)，响应时间较长，前端需展示“AI 正在深度思考中...”的加载状态。

### 2.3 健康报告生成 (Step 3)
*   **触发**：问卷信息采集完毕后，AI 生成最终报告数据。
*   **展示**：
    *   **核心仪表盘**：健康评分 (0-100)、风险等级、一句话综述。
    *   **深度风险解析**：详细列出 1-2 个关键风险点及其潜在影响。
    *   **定制行动方案**：饮食、运动、生活微习惯的具体建议（Action Item）。
    *   **可视化**：使用图表展示评分或风险维度（前端实现）。

### 2.4 产品推荐
*   **交互**：报告页底部提供“查看推荐产品”按钮。
*   **展示**：点击后，根据风险点展示对应的营养补充剂或健康产品（初期使用占位图）。

## 3. 技术架构

### 3.1 前端架构
*   **技术栈**：Vue 3 + Vite + Element Plus + Axios + Pinia (状态管理)。
*   **目录结构**：`frontend/` 目录，包含 `src/api`, `src/components`, `src/views` 等。
*   **关键特性**：
    *   组件化开发（复用聊天气泡、选项卡、图表组件）。
    *   响应式布局（适配移动端/桌面端）。
    *   Mock 数据与真实 API 的无缝切换。

### 3.2 后端架构
*   **技术栈**：Python FastAPI + Uvicorn。
*   **规范**：遵循企业级分层架构 (Controller-Service-Model)。
    *   `api/`：路由层，处理 HTTP 请求。
    *   `services/`：业务逻辑层，处理 AI 调用、数据组装。
    *   `models/`：数据模型层 (SQLAlchemy + Pydantic)。
*   **数据库**：SQLite (初期版本)，使用 SQLAlchemy ORM 进行管理，方便未来迁移至 PostgreSQL。
*   **安全**：
    *   环境变量管理 (.env)。
    *   API Key 保护。
    *   输入数据清洗。

### 3.3 AI 集成 (DeepSeek)
*   **模型**：`deepseek-reasoner` (思考模式)。
*   **配置**：
    *   API Endpoint: `https://api.deepseek.com/v1/chat/completions`
    *   Timeout: 300s。
    *   Temperature: **禁用**。
*   **Prompt Engineering**：
    *   严格执行 `生成问题.txt` 中的 Role Play、Constraints 和 Output Format。
    *   使用 System Prompt 注入核心逻辑。

## 4. 数据模型设计 (初步)

### 4.1 User (用户表)
*   `id`: Integer, PK
*   `username`: String (登录账号)
*   `password_hash`: String
*   `created_at`: DateTime

### 4.2 Session (会话表)
*   `id`: Integer, PK
*   `user_id`: Integer, FK
*   `status`: Enum (active, completed)
*   `user_profile`: JSON (存储年龄、性别、主诉)
*   `selected_track`: String (赛道)
*   `created_at`: DateTime

### 4.3 Message (消息记录表)
*   `id`: Integer, PK
*   `session_id`: Integer, FK
*   `role`: Enum (user, assistant, system)
*   `content`: Text
*   `created_at`: DateTime

### 4.4 Report (报告表)
*   `id`: Integer, PK
*   `session_id`: Integer, FK
*   `score`: Integer
*   `risk_level`: String
*   `content_json`: JSON (完整的报告结构化数据)
*   `created_at`: DateTime

## 5. 接口规划 (Draft)

*   `POST /api/auth/login`: 登录获取 Token。
*   `POST /api/chat/start`: 开启新会话，重置上下文。
*   `POST /api/chat/message`: 发送用户消息，获取 AI 回复 (阻塞式，含思考时间)。
*   `GET /api/report/{session_id}`: 获取结构化报告数据。
*   `GET /api/products/recommend`: 获取推荐产品列表 (Mock)。

## 6. 开发规范
*   **Linting**: Python 使用 Black + Flake8；Frontend 使用 ESLint + Prettier。
*   **Env**: 所有敏感信息（API Key、Secret Key）必须走 `.env` 文件。

